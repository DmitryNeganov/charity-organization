# charity-organization/благотворительная-организация

Серверное приложение для распределения поступающих пожертвований по активным проектам в соотвествии со степенью вовлеченности (от 1 до 5).

Структура базы данных:
 
![изображение](https://user-images.githubusercontent.com/102044344/232735152-6d579468-a24b-462f-b17c-94ac1d1683ac.png)

В приложении реализовано 4 сущности:
1.	Project<br>
2.	Donation<br>
3.	Sponsor<br>
4.	DonationDistributionRecord<br>

Для взаимодействия реализованы 2 контроллера:<br>
1.	ProjectController (/projects/). Имеет 6 методов-действий:<br>
1.1.	getAllProjects – (GET) получить список всех проектов<br>
1.2.	getProjectById – (GET) получить проект по ID<br>
1.3.	createProject – (POST) создать проект, необходимо передать в теле запроса необходимо передать название, начальный бюджет и коэффициент вовлеченности (от 1 до 5)<br>
1.4.	 deactivateProject – (GET) приостановить внесение в проект пожертвований<br>
1.5.	activateProject – (GET) возобновить внесение в проект пожертвований<br>
2.	DonationController<br>
2.1.	findAllDonations – (GET) получить список всех пожертвований<br>
2.2.	getDonationById – (GET) получить пожертвование по ID<br>
2.3.	createDonation – (POST) создать пожертвование, нужно передать сумму пожертвования и название(имя) спонсора<br>

После создания пожертвования, оно распределяется по существующим активным проектам согласно их коэффициенту вовлеченности. Это реализовано в сервис классе DonationDistributionEngine, который получает из базы данных сумму коэффициентов вовлеченности всех проектов. Потом добавляет в бюджет каждого активного проекта пропорционально его коэффициенту вовлеченности сумму из пожертвования. 
Для работы с базой данных созданы сервис классы DonationService, ProjectService, SponsorService и интерфейсы репозитория для каждой сущности.
Для валидации входящих данных POST запросов используются ProjectDTO и DonationDTO классы. Для маппинга данных созданы сервисные классы ProjectMapper и DonationMapper.

Приложение намеренно не позволяет:
1.	удалять проекты. Можно только создавать, деактивировать или активировать.
2.	удалять или добавлять спонсоров – это доступно только через осуществление пожертвования.

Использованный стек технологий: <br>
<b>Spring Boot 3.0.5</b>
<br>
<b>Java 17</b>
<br>
<b>Gradle</b>
<br>
<b>PostgreSQL</b>
<br>
<b>Liquibase</b> – для внесения дальнейших изменений в базу данных.
<br>
<b>Docker</b> – в корне репозитория находится docker-compose файл для разворачивания контейнера с базой данных и сервиса взаимодействия с базой.
<br>
<b>Swagger UI</b> доступен по пути /swagger-doc/swagger-ui/index.html
<br>
<b>Lombok</b> для сокращения кода
<br>
<b>Junit5</b> и <b>Mockito</b> для тестов
<br>

<b>Узкое место по производительности</b> – движок распределения пожертвований при получении нового пожертвования проходит по всем проектам, которые есть в базе данных. Когда у организации будет слишком много «старых» неактивных проектов, это будет замедлять работу приложения. Для этого можно предусмотреть индексацию на стороне базы данных только активных проектов. Тогда движок распределения может проходить только по активным проектам.


В стадии разработки:
0) Покрытие сервис-классов тестами
1)	Дополнительная нормализация базы данных: сущность projects содержит поле budget, которое дублируется в сущности donation_distribution_records. В связи с этим, можно оставить в сущности projects только starting_budget и получать полный бюджет проекта через JOIN запрос. Пока нереализовано, чтобы не усложнять понимание структуры БД.
2)	Если бизнес задача потребует также хранения в таблице спонсоров значение итоговой суммы пожертвований спонсора (с нескольких пожертвований например) – будет добавлено.
3)	Исправление узкого места по производительности (выше предложен способ)
